<div data-ng-controller="BusesController as busesCtrl">

    <!-- A dynamic template to build a tree with AngularJS -->
    <script type="text/ng-template" id="my-tmpl">
        <md-content class="md-whiteframe-8dp"
                    ng-model="nodeType"
                    ng-click="selectItem(node)"
                    ng-class="! sItem || sItem === node ? 'normal' : 'faded'">
            <md-menu-item>
                <md-button class="md-raised md-cornered" ng-click="switchChildrenVisibility(node)">
                    <md-icon class="md-24 md-accent" ng-show="node.childrenWereVisible">keyboard_arrow_right
                    </md-icon>
                    <md-icon class="md-24 md-accent" ng-show="! node.childrenWereVisible">keyboard_arrow_down
                    </md-icon>
                    {{ node.name }}
                    <md-icon class="md-24 md-accent">{{node.icon}}</md-icon>
                </md-button>
            </md-menu-item>
        </md-content>


        <!-- Show node & children nodes -->
        <ul>
            <li flex ng-show="node.visible || searchText.length > 0"
                ng-repeat="node in node.children | filter:searchText"
                ng-include="'my-tmpl'"></li>
        </ul>
    </script>

    <p flex ng-repeat="node in rootNodes" ng-include="'my-tmpl'"></p>

</div>